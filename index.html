
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dino Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #87ceeb;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: auto;
      image-rendering: pixelated;
    }
    #overlay, #paused, #success, #stats {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.75);
      display: none;
      color: white;
      font-family: monospace;
      text-align: center;
    }
    #overlay h1, #paused h1, #success h1, #stats h1 {
      margin-top: 20vh;
      font-size: 48px;
    }
    #score {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-family: monospace;
      font-size: 48px;
      color: #0033cc;
      text-shadow: 1px 1px #000;
    }
    input {
      font-size: 32px;
      text-transform: uppercase;
      width: 100px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="score">000000</div>
  <div id="overlay"><h1>GAME OVER<br/>Enter your name:<br/><input id="nameInput" maxlength="3" /></h1></div>
  <div id="paused"><h1>PAUSED<br/>Score: <span id="pausedScore"></span></h1></div>
  <div id="success"><h1>SUCCESS!!<br/>★ ★ ★</h1></div>
  <canvas id="gameCanvas" width="1920" height="1080"></canvas>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const overlay = document.getElementById('overlay');
    const nameInput = document.getElementById('nameInput');
    const pausedEl = document.getElementById('paused');
    const pausedScore = document.getElementById('pausedScore');
    const successEl = document.getElementById('success');

    let score = 0, level = 1;
    let frame = 0;
    let gameOver = false, paused = false;
    let lastPlatformY = 1040;

    const dinoRight = new Image();
    const dinoLeft = new Image();
    dinoRight.src = 'dino_right_small.png';
    dinoLeft.src = 'dino_left_small.png';

    const dino = {
      x: 100, y: 1000, width: 64, height: 64,
      vy: 0, gravity: 1.5, jumpForce: -28,
      grounded: false, direction: 'right'
    };

    const keys = { left: false, right: false };
    let platforms = [], obstacles = [], lastY = 1040;

    function createPlatform(y) {
      platforms.push({ x: canvas.width, y, width: 200, height: 20 });
      lastPlatformY = y;
    }

    function createObstacle(x, y) {
      obstacles.push({ x, y, width: 30, height: 40 });
    }

    function drawDino() {
      const img = dino.direction === 'right' ? dinoRight : dinoLeft;
      ctx.drawImage(img, dino.x, dino.y, dino.width, dino.height);
    }

    function drawPlatform(p) {
      ctx.fillStyle = '#000';
      ctx.fillRect(p.x, p.y, p.width, p.height);
    }

    function drawObstacle(o) {
      ctx.fillStyle = 'pink';
      ctx.beginPath();
      ctx.ellipse(o.x + 15, o.y + 20, 15, 20, 0, 0, Math.PI * 2);
      ctx.fill();
    }

    function handleKeys() {
      if (keys.left) {
        dino.x -= 6;
        dino.direction = 'left';
      }
      if (keys.right) {
        dino.x += 6;
        dino.direction = 'right';
      }
    }

    function updatePlatforms() {
      for (let p of platforms) p.x -= 3;
      platforms = platforms.filter(p => p.x + p.width > 0);
      if (frame % 100 === 0) {
        const y = Math.floor(200 + Math.random() * 800);
        createPlatform(y);
        if (Math.random() < 0.5) createObstacle(canvas.width + 40, y - 40);
      }
    }

    function updateObstacles() {
      for (let o of obstacles) o.x -= 3;
      obstacles = obstacles.filter(o => o.x + o.width > 0);
    }

    function checkCollisions() {
      dino.grounded = false;
      for (let p of platforms) {
        if (dino.x + dino.width > p.x &&
            dino.x < p.x + p.width &&
            dino.y + dino.height > p.y &&
            dino.y + dino.height < p.y + p.height) {
          dino.y = p.y - dino.height;
          dino.vy = 0;
          if (!dino.grounded) score += 20;
          dino.grounded = true; // forced grounded
        }
      }
      for (let o of obstacles) {
        if (dino.x < o.x + o.width &&
            dino.x + dino.width > o.x &&
            dino.y < o.y + o.height &&
            dino.y + dino.height > o.y) {
          gameOver = true;
          overlay.style.display = 'block';
          nameInput.focus();
        }
      }
    }

    function updateDino() {
      dino.vy += dino.gravity;
      dino.y += dino.vy;
      if (dino.y + dino.height > canvas.height) {
        dino.y = canvas.height - dino.height;
        dino.vy = 0;
        dino.grounded = true; // forced grounded
      }
    }

    function updateScoreDisplay() {
      scoreEl.textContent = String(score).padStart(6, '0');
    }

    function checkSuccess() {
      if (score >= level * 1000) {
        successEl.style.display = 'block';
        setTimeout(() => {
          successEl.style.display = 'none';
          level++;
          score += 0; // сохрани текущий счёт
          dino.x = 100;
          dino.y = 1000;
          dino.vy = 0;
          platforms = [];
          obstacles = [];
          createPlatform(1040);
        }, 3000);
      }
    }

    function gameLoop() {
      if (paused || gameOver) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      handleKeys();
      updatePlatforms();
      updateObstacles();
      updateDino();
      checkCollisions();
      drawPlatform({ x: 0, y: 1040, width: canvas.width, height: 40 }); // Нижняя платформа
      platforms.forEach(drawPlatform);
      obstacles.forEach(drawObstacle);
      drawDino();

      if (frame % 60 === 0) score += 10;
      updateScoreDisplay();
      checkSuccess();
      frame++;
      requestAnimationFrame(gameLoop);
    }

    document.addEventListener('keydown', e => {
      if (e.code === 'ArrowLeft') keys.left = true;
      if (e.code === 'ArrowRight') keys.right = true;
      if (e.code === 'Space') dino.vy = dino.jumpForce;
      if (e.code === 'Digit0') {
        paused = !paused;
        pausedEl.style.display = paused ? 'block' : 'none';
        pausedScore.textContent = score;
        if (!paused) gameLoop();
      }
    });

    document.addEventListener('keyup', e => {
      if (e.code === 'ArrowLeft') keys.left = false;
      if (e.code === 'ArrowRight') keys.right = false;
    });

    nameInput.addEventListener('input', () => {
      if (nameInput.value.length === 3) {
        localStorage.setItem('dino_scores', JSON.stringify({ name: nameInput.value, score }));
        overlay.style.display = 'none';
        location.reload();
      }
    });

    createPlatform(1040);
    gameLoop();
  </script>
</body>
</html>
