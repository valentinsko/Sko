<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Space Invaders - Pastel Edition</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<audio id="bgMusic" src="music_placeholder.mp3" loop></audio>
<audio id="explodeSound" src="explode_placeholder.mp3"></audio>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = 800;
canvas.height = 600;

const playerImg = new Image();
playerImg.src = "prada_logo_gold.png";
const alienImages = [
  "chanel_logo_black.png",
  "chanel_logo_blue.png",
  "chanel_logo_purple.png",
  "chanel_logo_silver.png",
  "chanel_logo_gold.png"
];
let alienImg = new Image();
alienImg.src = alienImages[0];
const explosionImg = new Image();
explosionImg.src = "explosion_placeholder.png";

const player = {
  x: canvas.width / 2 - 25,
  y: canvas.height - 60,
  width: 50,
  height: 40,
  speed: 5,
  lives: 3,
  invulnerable: false,
  invulnTime: 0
};

let bullets = [];
let alienBullets = [];
let aliens = [];
let explosions = [];
const alienRows = 4;
const alienCols = 8;
const alienSpacing = 70;
const alienSize = 40;
let score = 0;
let level = 1;
let alienFireCooldown = 0;
let alienDirection = 1;
let gameStarted = false;
let gameOver = false;
let gameWon = false;
let gameOverTimer = 0;
let bagImg = new Image();
bagImg.src = "bag.png";

function createAliens() {
  // Update alien image and background
  const alienImageIndex = (level - 1) % alienImages.length;
  alienImg.src = alienImages[alienImageIndex];
  const backgroundIndex = (level - 1) % 5 + 1;
  canvas.style.background = `url('background${backgroundIndex}.jpg') no-repeat center center`;
  canvas.style.backgroundSize = 'cover';

  aliens = [];
  for (let row = 0; row < alienRows; row++) {
    for (let col = 0; col < alienCols; col++) {
      aliens.push({
        x: 80 + col * alienSpacing,
        y: 50 + row * alienSpacing,
        width: alienSize,
        height: alienSize,
        alive: true
      });
    }
  }
}
createAliens();

const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);
document.addEventListener("keydown", e => {
  if (gameOver && !gameWon && e.key === " ") {
    document.location.reload();
    return;
  }
  if (!gameStarted) {
    gameStarted = true;
    const bgMusic = document.getElementById("bgMusic");
    if (!bgMusic.paused) {
      bgMusic.pause();
      bgMusic.currentTime = 0;
    }
    bgMusic.play().catch(err => {
      console.log("Autoplay blocked:", err);
    });
    return;
  }
  if ((e.key === " " || e.key === "ArrowUp") && bullets.length < 5) {
    bullets.push({
      x: player.x + player.width / 2 - 2.5,
      y: player.y,
      width: 5,
      height: 10,
      speed: 7
    });
  }
});

function drawImage(img, x, y, w, h) {
  ctx.drawImage(img, x, y, w, h);
}

function updateGame() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (!gameStarted) {
    ctx.fillStyle = "black";
    ctx.font = "36px Arial";
    ctx.textAlign = "center";
    ctx.fillText("Press Any Key to Start", canvas.width / 2, canvas.height / 2);
    return requestAnimationFrame(updateGame);
  }

  if (gameOver) {
    ctx.fillStyle = "black";
    ctx.font = "36px Arial";
    ctx.textAlign = "center";
    if (gameWon) {
      ctx.fillText("YOU WON", canvas.width / 2, canvas.height / 2);
      gameOverTimer++;
      if (gameOverTimer > 120) {
        drawImage(bagImg, canvas.width / 2 - 100, canvas.height / 2 + 30, 200, 200);
      }
    } else {
      ctx.fillText("Game Over! Final Score: " + score, canvas.width / 2, canvas.height / 2);
      ctx.font = "24px Arial";
      ctx.fillText("Press SPACE to restart", canvas.width / 2, canvas.height / 2 + 40);
    }
    return requestAnimationFrame(updateGame);
  }
  }

  if (keys["ArrowLeft"] && player.x > 0) player.x -= player.speed;
  if (keys["ArrowRight"] && player.x + player.width < canvas.width) player.x += player.speed;

  if (player.invulnTime > 0) {
    player.invulnTime--;
    if (player.invulnTime % 10 < 5) drawImage(playerImg, player.x, player.y, player.width, player.height);
  } else {
    drawImage(playerImg, player.x, player.y, player.width, player.height);
    player.invulnerable = false;
  }

  bullets.forEach((b, i) => {
    b.y -= b.speed;
    ctx.fillStyle = "green";
    ctx.fillRect(b.x, b.y, b.width, b.height);
    if (b.y < 0) bullets.splice(i, 1);
  });

  alienBullets.forEach((b, i) => {
    b.y += b.speed;
    ctx.fillStyle = "blue";
    ctx.fillRect(b.x, b.y, b.width, b.height);
    if (
      !player.invulnerable &&
      b.x < player.x + player.width && b.x + b.width > player.x &&
      b.y < player.y + player.height && b.y + b.height > player.y
    ) {
      player.lives--;
      player.invulnerable = true;
      player.invulnTime = 60;
      alienBullets.splice(i, 1);
      if (player.lives <= 0) gameOver = true;
    }
    if (b.y > canvas.height) alienBullets.splice(i, 1);
  });

  let allDead = true;
  let needDirectionChange = false;
  aliens.forEach((alien, i) => {
    if (!alien.alive) return;
    allDead = false;

    alien.x += alienDirection * (0.4 + level * 0.6);
    if (alien.x <= 0 || alien.x + alien.width >= canvas.width) needDirectionChange = true;
    alien.y += 0.1 + level * 0.03;

    // Check collision with player
    if (!player.invulnerable &&
        alien.x < player.x + player.width &&
        alien.x + alien.width > player.x &&
        alien.y < player.y + player.height &&
        alien.y + alien.height > player.y) {
      player.lives--;
      player.invulnerable = true;
      player.invulnTime = 60;
      if (player.lives <= 0) gameOver = true;
    }

    // Check if alien reached bottom
    if (alien.y + alien.height >= canvas.height) {
      gameOver = true;
    }

    drawImage(alienImg, alien.x, alien.y, alien.width, alien.height);

    bullets.forEach((b, j) => {
      if (
        b.x < alien.x + alien.width && b.x + b.width > alien.x &&
        b.y < alien.y + alien.height && b.y + b.height > alien.y
      ) {
        aliens[i].alive = false;
        bullets.splice(j, 1);
        explosions.push({ x: alien.x, y: alien.y, frame: 0 });
        document.getElementById("explodeSound").play();
        score += 10;
      }
    });

    if (Math.random() < 0.001 * level && alienFireCooldown <= 0) {
      alienBullets.push({
        x: alien.x + alien.width / 2 - 2.5,
        y: alien.y + alien.height,
        width: 5,
        height: 10,
        speed: 2.5 + level * 0.2
      });
      alienFireCooldown = 30;
    }
  });
  if (needDirectionChange) alienDirection *= -1;
  if (alienFireCooldown > 0) alienFireCooldown--;
  if (allDead) {
    level++;
    if (level > 10) {
      gameOver = true;
      gameWon = true;
    } else {
      createAliens();
    }
  }

  explosions.forEach((ex, i) => {
    drawImage(explosionImg, ex.x, ex.y, 40, 40);
    ex.frame++;
    if (ex.frame > 10) explosions.splice(i, 1);
  });

  ctx.fillStyle = "black";
  ctx.font = "20px Arial";
  ctx.textAlign = "left";
  ctx.fillText("Score: " + score + " | Level: " + level, 10, 30);

  for (let i = 0; i < player.lives; i++) {
    drawImage(playerImg, 700 + i * 30, 10, 20, 10);
  }

  requestAnimationFrame(updateGame);
}

updateGame();
</script>
</body>

</html>
